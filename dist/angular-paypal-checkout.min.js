angular.module("jmp.paypalCheckout",["jmp/templates/button.html"]).directive("paypalCheckout",function(){return{restrict:"E",replace:!0,scope:{config:"=?",onEnter:"&?",onComplete:"&?",onCancel:"&?"},templateUrl:function(t,n){return n.templateUrl||"jmp/templates/button.html"},link:function(r,t,n){var e,o,a,i="https://www.paypalobjects.com/api/checkout.js";function c(n,e){var o={env:"sandbox"};n&&r.$evalAsync(function(){var t;e.id?r.id=e.id:r.id="default",n.sandbox||(o.env="production"),o.client={sandbox:n.sandboxClientID||"",production:n.productionClientID||""},o.style=n.style,n.checkoutFlow&&(o.commit=!0),o.payment=p,o.onEnter=u,o.onAuthorize=l,o.onCancel=m,o.onError=d,n.hasOwnProperty("transactions")&&"object"==typeof n.transactions&&n.transactions.constructor===Array&&n.transactions.length?o.transactions=function(t){var n=[];if(t&&t.length)for(var e=0,o=t.length;e<o;e++){var r=t[e],a={reference_id:r.referenceID||"",amount:{total:r.totalAmount,currency:r.currency,details:{subtotal:r.subtotal||0,tax:r.tax||0,shipping:r.shipping||0}}};r.hasOwnProperty("items")&&r.length&&(a.item_list=s(r.items)),r.hasOwnProperty("orderID")&&(a.purchase_order=r.orderID),n.push(a)}return n}(n.transactions):n.hasOwnProperty("payments")&&"object"==typeof n.payments&&n.payments.constructor===Object&&(o.transactions=[function(t){if(t){var n={reference_id:t.referenceID||"",amount:{total:t.totalAmount,currency:t.currency,details:{subtotal:t.subTotalAmount,tax:t.tax||0,shipping:t.shippingFee||0}}};return t.hasOwnProperty("items")&&(n.item_list={items:s(t.items)}),n}}(n.payments)]),r.options=o,t=r.options,window.paypal&&(console.log(t),window.paypal.Button.render(t,"#paypal-button-"+r.id))})}function s(t){var n=[];if(t&&t.length)for(var e=0,o=t.length;e<o;e++){var r=t[e],a={name:r.name,description:r.description||"",quantity:r.quantity||0,price:r.price||0,tax:r.tax||0,currency:r.currency};r.hasOwnProperty("sku")&&(a.sku=r.sku),n.push(a)}return n}function p(t,n){return n.payment.create({experience:{input_fields:{no_shipping:1,address_override:1}},payment:{payer:{payment_method:"paypal"},transactions:r.options.transactions}})}function u(){r.onEnter&&r.$evalAsync(function(){r.onEnter()(r.options)})}function l(t,n){return n.payment.execute().then(function(t){r.onComplete&&r.$evalAsync(function(){r.onComplete()(t,n,r.options)})})}function m(t,n){r.onCancel&&r.$evalAsync(function(){r.onCancel()(t,n,r.options)})}function d(t){r.onError&&r.$evalAsync(function(){r.onError()(t,r.options)})}r.environment="sandbox",r.$watch("config",function(t){t&&c(t,n)}),function(t){var n=!1,e=angular.element("script");if(e.length)for(var o=0,r=e.length;o<r;o++){var a=String(e[o].src);if(-1!==a.indexOf("http")&&(a=a.substr(a.indexOf("//"))),n=a===t)break}return n}(i)?(r.onReady(),c(r.config,n)):(e=i,o=n,(a=document.createElement("script")).setAttribute("src",e),a.onload=function(t){c(r.config,o)},document.body.appendChild(a))}}}),angular.module("jmp/templates/button.html",[]).run(["$templateCache",function(t){t.put("jmp/templates/button.html",'<div class="jmp-directive paypal-checkout-button">\n<div id="paypal-button-{{ id }}"></div>\n</div>')}]);